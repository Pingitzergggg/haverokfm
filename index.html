<!DOCTYPE html>
<html lang="hu">
<head>

  <!-- PWA Compatibility -->
  <link rel="manifest" href="manifest.json">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="description" content="Haverok FM - Mindenf√©le zen√©k a 80-as √©vekt≈ël teljesen mostan√°ig. Internet r√°di√≥ by haverok for haverok.">
  <meta name="keywords" content="HaverokFM, haverokfm, Haverokfm, haverok fm, Haverok FM, HAVEROKFM, haverok FM, Haverok fm, r√°di√≥, internet radio, zene, magyar r√°di√≥, online r√°di√≥">
  <meta name="author" content="Erik">
  <meta name="theme-color" content="#311B0B">
  
  <!-- Open Graph / Facebook / Discord -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="HaverokFM">
  <meta property="og:description" content="Mindenf√©le zen√©k a 80-as √©vekt≈ël teljesen mostan√°ig. By haverok for haverok.">
  <meta property="og:image" content="https://media.discordapp.net/attachments/1170847305902075907/1448090781318516887/haverokfmm.png?ex=6939ff22&is=6938ada2&hm=908f91c7ba95b84f1f3e38dddce4972cd302bd88f0d79fae3ade243af3e664de&=&format=webp&quality=lossless">
  <meta property="og:url" content="https://erik-server.ddns.net">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="HaverokFM">
  <meta name="twitter:description" content="Mindenf√©le zen√©k a 80-as √©vekt≈ël teljesen mostan√°ig.">
  <meta name="twitter:image" content="https://media.discordapp.net/attachments/1170847305902075907/1448090781318516887/haverokfmm.png?ex=6939ff22&is=6938ada2&hm=908f91c7ba95b84f1f3e38dddce4972cd302bd88f0d79fae3ade243af3e664de&=&format=webp&quality=lossless">
  
  <!-- Apple -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="HaverokFM">
  
  <title>HaverokFM</title>
  <link rel="icon" type="image/png" href="https://media.discordapp.net/attachments/1170847305902075907/1448090781318516887/haverokfmm.png?ex=6939ff22&is=6938ada2&hm=908f91c7ba95b84f1f3e38dddce4972cd302bd88f0d79fae3ade243af3e664de&=&format=webp&quality=lossless">

  <!-- Service Worker (Required for PWA) -->
  <script src="service-worker.js"></script>

  <style>
    /*----------------------------------------*/
    /* 1) Prevent all scrolling/overflow       */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      touch-action: pan-y;
      background-color: #311B0B;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      box-sizing: border-box;
      transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    body.stats-open {
      transform: translateX(-280px);
      overflow: hidden;
    }

    /*----------------------------------------*/
    /* 2) Blurred background image            */
    #bg-blur {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      filter: blur(25px) brightness(0.7);
      pointer-events: none;
      z-index: 0;
      transition: opacity 0.5s ease;
    }

    /*----------------------------------------*/
    /* 3) Header + Safe-Area Handling         */
    #header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      pointer-events: none;
      z-index: 2;
      overflow: visible; /* EZ FONTOS! */
    }
    #logo {
      position: absolute;
      top: calc(16px + env(safe-area-inset-top));
      left: calc(16px + env(safe-area-inset-left));
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 2px;
      pointer-events: auto;
      user-select: none;
      color: #fff;
    }

    /* Duplik√°lt info (About) gomb a fullscreen mell√© */
    #info-btn-wrapper2 {
      position: absolute;
      top: 0;
      right: calc(64px + 48px + env(safe-area-inset-right));
    }
    #info-btn2 {
      width: 200px;
      position: absolute;
      top: calc(12px + env(safe-area-inset-top));
      right: calc(1px + env(safe-area-inset-right));
      height: 40px;
      min-width: 40px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      outline: none;
      pointer-events: auto;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s ease, transform 0.08s ease;
    }
    #info-btn2:hover {
      background: rgba(255,255,255,0.1);
    }
    #info-btn2:active {
      transform: scale(0.98);
    }
    #info-btn2 svg {
      width: 20px;
      height: 20px;
    }

    /* info (About) button */
    #info-btn {
      position: absolute;
      top: calc(12px + env(safe-area-inset-top));
      right: calc(64px + env(safe-area-inset-right));
      height: 40px;
      min-width: 40px;
      padding: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      outline: none;
      pointer-events: auto;
      user-select: none;
      transition: background 0.15s ease, transform 0.08s ease;
    }
    #info-btn:hover {
      background: rgba(255,255,255,0.1);
    }
    #info-btn:active {
      transform: scale(0.98);
    }
    #info-btn svg {
      width: 20px;
      height: 20px;
    }

    /* Fullscreen button */
    #fullscreen-btn {
      position: absolute;
      top: calc(12px + env(safe-area-inset-top));
      right: calc(16px + env(safe-area-inset-right));
      height: 40px;
      min-width: 40px;
      padding: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      outline: none;
      pointer-events: auto;
      user-select: none;
      transition: background 0.15s ease, transform 0.08s ease;
    }
    #fullscreen-btn:hover {
      background: rgba(255,255,255,0.1);
    }
    #fullscreen-btn:active {
      transform: scale(0.98);
    }
    #fullscreen-btn svg {
      width: 20px;
      height: 20px;
    }

    /* info notification (√∫j) */
    #info-notification {
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(135deg, #311B0B 0%, #4a2a15 100%);
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      padding: 9px 18px 9px 18px;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.28);
      border: 1px solid rgba(255,255,255,0.13);
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: fadeIn 0.7s cubic-bezier(0.25,0.46,0.45,0.94);
      transition: opacity 0.3s, transform 0.3s;
      opacity: 1;
      pointer-events: auto;
      user-select: none;
      min-width: 150px;
      white-space: nowrap;
    }
    #info-notification .arrow-left {
      display: block;
      width: 0;
      height: 0;
      border-top: 10px solid transparent;
      border-bottom: 10px solid transparent;
      border-right: 14px solid #4a2a15;
      margin-left: -12px;
      margin-right: 0;
      filter: drop-shadow(0 0 6px #4ade80aa);
      animation: arrowBubblePulse 1.2s infinite alternate;
    }

    /*----------------------------------------*/
    /* 4) Modern stats panel */
    #stats-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 280px;
      height: 100vh;
      background: rgba(0, 0, 0, 0.4);
      color: #eaeaea;
      padding: 24px;
      box-sizing: border-box;
      z-index: 3000;
      border-left: 1px solid rgba(255,255,255,0.04);
      backdrop-filter: blur(25px) brightness(0.7);
      overflow-y: auto;
      overflow-x: hidden;
      transform: translateX(100%);
      transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: 0 14px 34px rgba(0,0,0,0.45);
    }
    #stats-panel.active {
      transform: translateX(0);
    }
    #stats-panel h2 {
      margin: calc(56px + env(safe-area-inset-top)) 0 12px;
      font-size: 1.3rem;
      font-weight: 700;
      color: #fff;
      letter-spacing: 0;
    }
    #stats-panel .divider {
      height: 1px;
      background: rgba(255, 255, 255, 0.08);
      margin: 16px 0;
    }
    #stats-panel p {
      margin: 0 0 16px;
      font-size: 1.1rem;
      color: #cfcfcf;
      line-height: 1.4;
    }
    .stat-group {
      margin-bottom: 16px;
    }
    .stat-group h3 {
      margin: 0 0 10px;
      font-size: 1rem;
      font-weight: 700;
      color: #fff;
    }
    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border: none;
      font-size: 1rem;
    }
    .stat-label {
      color: #9a9a9a;
      font-weight: 500;
    }
    .stat-value {
      color: #cfcfcf;
      font-weight: 500;
      text-align: right;
    }
    #close-stats {
      position: absolute;
      top: calc(12px + env(safe-area-inset-top));
      right: 16px;
      background: transparent;
      border: none;
      color: #cfcfcf;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      border-radius: 0;
      transition: color 0.15s ease;
      line-height: 1;
    }
    #close-stats:hover {
      color: #fff;
    }
    #close-stats:active {
      transform: scale(0.95);
    }

    /*----------------------------------------*/
    /* 5) Status indicator (slides up from controls) */
    #status-indicator {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(100%);
      background: rgba(0, 0, 0, 0.6);
      border-radius: 32px;
      padding: 8px 16px;
      color: #fff;
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
      pointer-events: none;
      margin-bottom: 8px;
      white-space: nowrap;
    }
    #status-indicator.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    #status-indicator::before {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #cfcfcf;
    }
    #status-indicator.buffering::before {
      background: #ffa500;
      animation: pulse 1.5s infinite;
    }
    #status-indicator.connected::before {
      background: #4ade80;
    }
    #status-indicator.error::before {
      background: #ef4444;
    }

    /* Update notification banner */
    #update-banner {
      position: fixed;
      top: calc(70px + env(safe-area-inset-top));
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      background: linear-gradient(135deg, #311B0B 0%, #4a2a15 100%);
      border-radius: 12px;
      padding: 12px 20px;
      color: #fff;
      font-size: 0.95rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      opacity: 0;
      z-index: 1000;
      transition: opacity 0.4s ease, transform 0.4s ease;
      max-width: calc(100vw - 32px);
      box-sizing: border-box;
    }
    #update-banner.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    #update-banner .update-icon {
      font-size: 1.3rem;
    }
    #update-banner .update-text {
      flex: 1;
      line-height: 1.3;
    }
    #update-banner .update-version {
      color: #4ade80;
      font-weight: 700;
    }
    #update-banner .close-banner {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #fff;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: background 0.2s;
    }
    #update-banner .close-banner:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /*----------------------------------------*/
    /* 6) Main content (centered, below header) */
    #main-content {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      padding-top: calc(56px + env(safe-area-inset-top));
      padding-bottom: calc(80px + env(safe-area-inset-bottom));
      box-sizing: border-box;
      text-align: center;
      z-index: 1;
    }

    /* COVER CARD */
    #cover-card {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 4px 32px rgba(0, 0, 0, 0.3);
      display: inline-flex;
      flex-direction: row;
      align-items: center;
      gap: 20px;
      max-width: calc(90vw - 32px);
      box-sizing: border-box;
    }
    #album-cover {
      width: clamp(160px, 30vw, 280px);
      height: clamp(160px, 30vw, 280px);
      background: #333;
      border-radius: 12px;
      box-shadow: 0 2px 14px rgba(0, 0, 0, 0.5);
      object-fit: cover;
      object-position: center;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ccc;
      font-size: 3rem;
      border: 3px solid #fff;
      overflow: hidden;
      position: relative;
    }
    #album-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    #album-cover img.visible {
      opacity: 1;
    }
    #details {
      display: flex;
      flex-direction: column;
      justify-content: center;
      color: #fff;
      text-align: left;
    }
    #song-title {
      font-size: clamp(1.5rem, 4vw, 2rem);
      font-weight: 700;
      margin: 0 0 8px;
      letter-spacing: 0.5px;
      line-height: 1.2;
    }
    #song-artist {
      font-size: clamp(1rem, 3vw, 1.2rem);
      font-weight: 400;
      margin: 0;
      opacity: 0.9;
    }

    /*----------------------------------------*/
    /* 7) Bottom controls                     */
    #controls {
      position: absolute;
      bottom: calc(16px + env(safe-area-inset-bottom));
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.6);
      border-radius: 32px;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-sizing: border-box;
      max-width: calc(100vw - 32px);
      z-index: 10;
    }
    #play-btn {
      width: clamp(40px, 8vw, 50px);
      height: clamp(40px, 8vw, 50px);
      background: #fff;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      transition: background 0.2s;
      padding: 0;
      flex-shrink: 0;
    }
    #play-btn:hover {
      background: #eee;
    }
    #play-btn svg {
      width: clamp(18px, 4vw, 24px);
      height: clamp(18px, 4vw, 24px);
      fill: #311B0B;
    }
    #volume-slider {
      -webkit-appearance: none;
      width: clamp(80px, 20vw, 180px);
      height: 4px;
      background: #fff;
      border-radius: 2px;
      outline: none;
      cursor: pointer;
      flex-shrink: 1;
    }
    #volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #311B0B;
      cursor: pointer;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.3);
    }
    #volume-slider::-moz-range-thumb {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #311B0B;
      cursor: pointer;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.3);
    }
    #fullscreen-btn {
      position: absolute;
      top: calc(12px + env(safe-area-inset-top));
      right: calc(16px + env(safe-area-inset-right));
      height: 40px;
      min-width: 40px;
      padding: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      outline: none;
      pointer-events: auto;
      user-select: none;
      transition: background 0.15s ease, transform 0.08s ease;
    }
    #fullscreen-btn:hover {
      background: rgba(255,255,255,0.1);
    }
    #fullscreen-btn:active {
      transform: scale(0.98);
    }
    #fullscreen-btn svg {
      width: 20px;
      height: 20px;
    }

    /* --- √öJ: Info notification diz√°jn --- */
    #info-btn-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0;
    }
    #info-notification {
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(135deg, #311B0B 0%, #4a2a15 100%);
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      padding: 9px 18px 9px 18px;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.28);
      border: 1px solid rgba(255,255,255,0.13);
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: fadeIn 0.7s cubic-bezier(0.25,0.46,0.45,0.94);
      transition: opacity 0.3s, transform 0.3s;
      opacity: 1;
      pointer-events: auto; /* hogy biztosan l√°that√≥ legyen */
      user-select: none;
      min-width: 150px;
      white-space: nowrap;
    }
    #info-notification .arrow-left {
      display: block;
      width: 0;
      height: 0;
      border-top: 10px solid transparent;
      border-bottom: 10px solid transparent;
      border-right: 14px solid #4a2a15;
      margin-left: -12px;
      margin-right: 0;
      filter: drop-shadow(0 0 6px #4ade80aa);
      animation: arrowBubblePulse 1.2s infinite alternate;
    }
    @keyframes arrowBubblePulse {
      0% { filter: drop-shadow(0 0 6px #4ade8088); }
      100% { filter: drop-shadow(0 0 12px #4ade80); }
    }

    /* Mobilon igaz√≠t√°s */
    @media (max-width: 600px) {
      #info-notification {
        font-size: 0.98rem;
        min-width: 100px;
        padding: 7px 10px 7px 12px;
      }
      #info-notification .arrow-left {
        border-top: 7px solid transparent;
        border-bottom: 7px solid transparent;
        border-right: 10px solid #4a2a15;
        margin-left: -8px;
      }
    }

    @media only screen and (max-width: 600px) and (orientation: portrait) {
      #cover-card {
        flex-direction: column;
        align-items: center;
      }
      #details {
        text-align: center;
        margin-top: 12px;
      }
      #controls {
        gap: 12px;
        padding: 8px 16px;
      }
      #volume-slider {
        width: 120px;
      }
      #stats-panel {
        width: 100vw;
        right: 0;
        padding: 15px;
        transform: translateX(100%);
      }
      #stats-panel.active {
        transform: translateX(0);
      }
    }

    @media only screen and (max-width: 900px) and (orientation: landscape) {
      #album-cover {
        width: clamp(80px, 15vw, 120px) !important;
        height: clamp(80px, 15vw, 120px) !important;
      }
      #cover-card {
        max-width: calc(100vw - 64px);
        padding: 12px 16px;
        gap: 16px;
      }
      #song-title {
        font-size: clamp(1.2rem, 3vw, 1.6rem);
        margin: 0 0 4px;
      }
      #song-artist {
        font-size: clamp(0.9rem, 2.5vw, 1.1rem);
      }
      #stats-panel {
        width: 280px;
        right: -280px;
        padding: 12px;
        font-size: 0.75rem;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <!-- 1) Blurred background -->
  <img id="bg-blur" src="" alt="Background Cover">

  <!-- 2) Header -->
  <div id="header">
    <div id="logo">HaverokFM</div>

    <!-- Duplik√°lt info (About) gomb a fullscreen mell√© -->
    <div id="info-btn-wrapper2" style="position:absolute; top:0; right:calc(64px + 48px + env(safe-area-inset-right));">
      <button id="info-btn2">Pr√≥b√°ld ki az √∫j weboldalt &#x2794;</button>
    </div>

    <!-- Fullscreen button -->
    <button id="fullscreen-btn" aria-label="Fullscreen" title="Fullscreen">
      <svg id="fullscreen-icon" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
        <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
      </svg>
      <svg id="exit-fullscreen-icon" viewBox="0 0 24 24" width="20" height="20" fill="currentColor" style="display:none">
        <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
      </svg>
    </button>

    <!-- info (About) button -->
    <div id="info-btn-wrapper">
      <button id="info-btn" aria-label="Show stats" title="Stats">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>
          <text x="12" y="17" text-anchor="middle" font-size="14" font-weight="bold" fill="currentColor">i</text>
        </svg>
      </button>
    </div>
  </div>

  <!-- Settings & Stats Panel -->
  <div id="stats-panel">
    <button id="close-stats" aria-label="Close">√ó</button>

    <div style="margin: 24px 0 16px 0; text-align: center;">
      <div style="font-size: 1.1em; font-weight: bold; margin-bottom: 10px;">Pr√≥b√°ld ki a fejleszt√©s alatt √°ll√≥ weboldalt</div>
      <a href="https://hg-erik.github.io/haverokfm/test/" target="_blank" rel="noopener" style="display: inline-block; padding: 10px 28px; background: #4ade80; color: #222; border-radius: 8px; font-weight: bold; text-decoration: none; font-size: 1em; transition: background 0.15s;">lesgo</a>
    </div>
    <h2>About</h2>
    <p>This is an internet radio by Haverok for Haverok. Made by Erik.</p>

    <div class="divider"></div>

    <h2>Stats</h2>
    <div class="stat-group">
      <div class="stat-item">
        <span class="stat-label">Uptime</span>
        <span class="stat-value" id="stream-uptime">0s</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Delay</span>
        <span class="stat-value" id="stream-delay">0s</span>
      </div>
    </div>

    <div class="divider"></div>
    
    <div style="text-align: center; margin-top: 20px;">
      <div id="logo" style="position: relative; top: 0; left: 0; font-size: 1.8rem; font-weight: 600; letter-spacing: 2px; color: #fff;">HaverokFM</div>
    </div>
  </div>

  <!-- Status indicator -->
  
  <!-- Update notification banner -->
  <div id="update-banner">
    <span class="update-icon">üéâ</span>
    <span class="update-text">Friss√ºlt a weboldal! Az √∫j verzi√≥t √©lvezhetitek: <span class="update-version">HaverokFM 2.0</span></span>
    <button class="close-banner" aria-label="Bez√°r√°s">√ó</button>
  </div>

  <!-- 3) Main content -->
  <div id="main-content">
    <div id="cover-card">
      <div id="album-cover">
        <img src="https://via.placeholder.com/280?text=HaverokFM" alt="Album cover">
      </div>
      <div id="details">
        <div id="song-title">Nincs duma (Csak zene)</div>
        <div id="song-artist">HaverokFM</div>
      </div>
    </div>
  </div>

  <!-- 4) Bottom controls -->
  <div id="controls">
    <button id="play-btn" aria-label="Play/Pause">
      <svg id="play-icon" viewBox="0 0 64 64">
        <polygon points="16,8 56,32 16,56"></polygon>
      </svg>
      <svg id="pause-icon" viewBox="0 0 64 64" style="display:none">
        <rect x="16" y="12" width="12" height="40"></rect>
        <rect x="36" y="12" width="12" height="40"></rect>
      </svg>
    </button>
    <input id="volume-slider" type="range" min="0" max="1" step="0.01" value="1">
    <audio id="audio" preload="none"></audio>
    <!-- Status indicator inside controls -->
    <div id="status-indicator"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const audio        = document.getElementById('audio');
      const playBtn      = document.getElementById('play-btn');
      const playIcon     = document.getElementById('play-icon');
      const pauseIcon    = document.getElementById('pause-icon');
      const volumeSlider = document.getElementById('volume-slider');
      const statusIndicator = document.getElementById('status-indicator');
      const statsBtn     = document.getElementById('info-btn');
      const infoBtn2     = document.getElementById('info-btn2');
      const statsPanel   = document.getElementById('stats-panel');
      const closeStatsBtn = document.getElementById('close-stats');
      const fullscreenBtn = document.getElementById('fullscreen-btn');
      const fullscreenIcon = document.getElementById('fullscreen-icon');
      const exitFullscreenIcon = document.getElementById('exit-fullscreen-icon');

      const streamUrl = "https://erik-server.ddns.net/stream";
      const coverUrl = "https://erik-server.ddns.net/image";
      const metaUrl  = "https://erik-server.ddns.net/metadata";
      
      // State
      let isPlaying = false;
      let reconnectTimer = null;
      let lastSongData = { title: '', artist: '' };
      let currentCoverUrl = '';
      let playStartTime = null;
      let uptimeInterval = null;
      let shouldBePlaying = false;
      let isReconnecting = false;

      // Update banner
      const updateBanner = document.getElementById('update-banner');
      const closeBannerBtn = updateBanner.querySelector('.close-banner');
      
      // Check if user has seen the banner (localStorage)
      if (!localStorage.getItem('haverokfm-update-seen-2.0')) {
        setTimeout(() => {
          updateBanner.classList.add('show');
        }, 1000);
      }
      
      closeBannerBtn.addEventListener('click', () => {
        updateBanner.classList.remove('show');
        localStorage.setItem('haverokfm-update-seen-2.0', 'true');
      });

      // Initialize audio
      audio.src = streamUrl;
      audio.crossOrigin = "anonymous";
      audio.volume = volumeSlider.value;

      function setAlbumCover(url) {
        if (currentCoverUrl === url) return;
        currentCoverUrl = url;
        
        const img = new Image();
        img.crossOrigin = "anonymous";
        
        img.onload = () => {
          const existingImg = document.querySelector('#album-cover img');
          if (existingImg) {
            existingImg.src = url;
            existingImg.classList.add('visible');
          }
          document.getElementById('bg-blur').src = url;
          
          // Update Media Session with new artwork
          updateMediaSession();
        };
        
        img.onerror = () => {
          document.getElementById('album-cover').innerHTML = 'üìª';
        };
        
        img.src = url;
      }

      function updateMediaSession() {
        if ('mediaSession' in navigator) {
          navigator.mediaSession.metadata = new MediaMetadata({
            title: lastSongData.title || 'HaverokFM',
            artist: lastSongData.artist || 'HaverokFM',
            album: 'HaverokFM',
            artwork: [
              { src: currentCoverUrl || coverUrl, sizes: '96x96', type: 'image/jpeg' },
              { src: currentCoverUrl || coverUrl, sizes: '128x128', type: 'image/jpeg' },
              { src: currentCoverUrl || coverUrl, sizes: '192x192', type: 'image/jpeg' },
              { src: currentCoverUrl || coverUrl, sizes: '256x256', type: 'image/jpeg' },
              { src: currentCoverUrl || coverUrl, sizes: '384x384', type: 'image/jpeg' },
              { src: currentCoverUrl || coverUrl, sizes: '512x512', type: 'image/jpeg' }
            ]
          });

          // Play/Pause controls
          navigator.mediaSession.setActionHandler('play', () => {
            if (audio.paused) togglePlay();
          });
          navigator.mediaSession.setActionHandler('pause', () => {
            if (!audio.paused) togglePlay();
          });
          navigator.mediaSession.setActionHandler('stop', () => {
            shouldBePlaying = false;
            audio.pause();
            isPlaying = false;
          });
        }
      }

      async function fetchMetadata() {
        try {
          const response = await fetch(metaUrl);
          const txt = await response.text();
          let song = "Nincs duma (Csak zene)";
          let artist = "HaverokFM";

          try {
            const j = JSON.parse(txt);
            if (j.artist && j.title) {
              artist = j.artist;
              song = j.title;
            }
          } catch {
            if (txt.includes("#")) {
              const parts = txt.split("#");
              artist = parts[0].trim();
              song = parts[1].trim();
            }
          }

          if (lastSongData.title !== song || lastSongData.artist !== artist) {
            lastSongData = { title: song, artist: artist };
            document.getElementById('song-title').textContent = song;
            document.getElementById('song-artist').textContent = artist;
            setAlbumCover(coverUrl + '?t=' + Date.now());
            updateMediaSession();
            
          }
        } catch (e) {
          console.error('Metadata error:', e);
        }
      }

      function showStatus(message, type = '') {
        statusIndicator.textContent = message;
        statusIndicator.className = `show ${type}`;
        setTimeout(() => {
          statusIndicator.classList.remove('show');
        }, 3000);
      }

      function updateStats() {
        // Uptime calculation
        if (isPlaying && playStartTime) {
          const uptime = Math.floor((Date.now() - playStartTime) / 1000);
          const hours = Math.floor(uptime / 3600);
          const minutes = Math.floor((uptime % 3600) / 60);
          const seconds = uptime % 60;
          
          if (hours > 0) {
            document.getElementById('stream-uptime').textContent = `${hours}h ${minutes}m ${seconds}s`;
          } else if (minutes > 0) {
            document.getElementById('stream-uptime').textContent = `${minutes}m ${seconds}s`;
          } else {
            document.getElementById('stream-uptime').textContent = `${seconds}s`;
          }
        } else {
          document.getElementById('stream-uptime').textContent = '0s';
        }

        // Delay calculation (buffer delay)
        if (isPlaying && audio.buffered.length > 0) {
          const delay = (audio.buffered.end(0) - audio.currentTime).toFixed(1);
          document.getElementById('stream-delay').textContent = delay + 's';
        } else {
          document.getElementById('stream-delay').textContent = '0s';
        }
      }

      function togglePlay() {
        if (audio.paused) {
          // Start playing
          shouldBePlaying = true;
          showStatus('Connecting...', 'buffering');
          
          audio.play().then(() => {
            isPlaying = true;
            console.log('Stream started');
            showStatus('Connected', 'connected');
          }).catch(e => {
            console.error('Play failed:', e);
            showStatus('Failed to start', 'error');
            isPlaying = false;
            // Try reconnecting
            if (shouldBePlaying) {
              setTimeout(() => hardResetStream(), 1000);
            }
          });
        } else {
          // Stop playing
          shouldBePlaying = false;
          audio.pause();
          isPlaying = false;
          console.log('Stream stopped');
        }
      }

      // Audio event listeners
      audio.addEventListener('play', () => {
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
        isPlaying = true;
        playStartTime = Date.now();
        updateStats();
        updateMediaSession();
      });

      audio.addEventListener('pause', () => {
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
        isPlaying = false;
        if (shouldBePlaying) {
          playStartTime = null;
        }
        updateStats();
      });

      audio.addEventListener('error', (e) => {
        console.error('‚ö†Ô∏è Audio error:', e);
        if (shouldBePlaying && !isReconnecting) {
          hardResetStream();
        }
      });

      audio.addEventListener('stalled', () => {
        console.log('‚ö†Ô∏è Stream beakadt (stalled)');
        if (shouldBePlaying && !isReconnecting) {
          hardResetStream();
        }
      });

      // Waiting esem√©ny is beakad√°st jelezhet
      audio.addEventListener('waiting', () => {
        console.log('‚è≥ Buffering...');
        if (shouldBePlaying) {
          showStatus('Buffering...', 'buffering');
        }
      });

      function hardResetStream() {
        if (!shouldBePlaying || isReconnecting) return;
        
        isReconnecting = true;
        showStatus('Reconnecting...', 'buffering');
        
        // √öj URL timestamp-pel
        audio.src = streamUrl + '?t=' + Date.now();
        audio.load();
        
        // Pr√≥b√°lkoz√°s
        setTimeout(() => {
          audio.play().then(() => {
            showStatus('Connected', 'connected');
            isReconnecting = false;
          }).catch(() => {
            // Sikertelen, 1 mp m√∫lva √∫jra
            isReconnecting = false;
            if (shouldBePlaying) {
              setTimeout(hardResetStream, 1000);
            }
          });
        }, 500);
      }

      // Control event listeners
      playBtn.addEventListener('click', togglePlay);
      
      volumeSlider.addEventListener('input', e => {
        audio.volume = parseFloat(e.target.value);
        updateStats();
      });

      // Fullscreen controls
      fullscreenBtn.addEventListener('click', () => {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(err => {
            console.log('Fullscreen error:', err);
          });
        } else {
          document.exitFullscreen();
        }
      });

      document.addEventListener('fullscreenchange', () => {
        if (document.fullscreenElement) {
          fullscreenIcon.style.display = 'none';
          exitFullscreenIcon.style.display = 'block';
        } else {
          fullscreenIcon.style.display = 'block';
          exitFullscreenIcon.style.display = 'none';
        }
      });

      // Stats panel controls
      statsBtn.addEventListener('click', e => {
        statsPanel.classList.toggle('active');
        e.stopPropagation();
      });
      if (infoBtn2) {
        infoBtn2.addEventListener('click', e => {
          statsPanel.classList.toggle('active');
          e.stopPropagation();
        });
      }
      
      closeStatsBtn.addEventListener('click', () => {
        statsPanel.classList.remove('active');
      });

      // Close stats panel when clicking outside
      window.addEventListener('click', (e) => {
        if (!statsPanel.contains(e.target) && !statsBtn.contains(e.target)) {
          statsPanel.classList.remove('active');
        }
      });
      
      statsPanel.addEventListener('click', e => e.stopPropagation());

      // Initialize
      setAlbumCover(coverUrl);
      fetchMetadata();
      updateStats();
      
      // Update metadata every 5 seconds
      setInterval(fetchMetadata, 5000);
      setInterval(updateStats, 1000);
    });
  </script>
</body>
</html>

